<div *ngIf="toastMessage" class="fixed top-4 right-4 z-50">
    <div
      class="px-4 py-2 rounded shadow cursor-pointer"
      [ngClass]="{
        'bg-green-500 text-white': toastType === 'success',
        'bg-red-500 text-white': toastType === 'error'
      }"
      (click)="toastMessage = ''" 
    >
      {{ toastMessage }}
    </div>
  </div>

<app-title title="Usuarios"></app-title>

  <div *ngIf="showCreateModal" class="fixed inset-0 flex items-center justify-center z-50">
    <!-- Fondo semi-transparente -->
    <div class="fixed inset-0 bg-black opacity-50" (click)="closeCreateModal()"></div>
    
    <!-- Contenido del modal -->
    <div class="bg-white rounded-lg shadow-lg z-10 w-11/12 md:w-1/2 lg:w-1/3 p-6">
      <h2 class="text-xl font-bold mb-4">Crear Nuevo Usuario</h2>
      <form (ngSubmit)="createNewUser()">
        <div class="mb-4">
          <label class="block text-gray-700">Nombre</label>
          <input type="text" [(ngModel)]="newUser.Name" name="Name" required class="w-full border border-gray-300 p-2 rounded">
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Apellido Paterno</label>
          <input type="text" [(ngModel)]="newUser.ApellidoP" name="ApellidoP" required class="w-full border border-gray-300 p-2 rounded">
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Apellido Materno</label>
          <input type="text" [(ngModel)]="newUser.ApellidoM" name="ApellidoM" class="w-full border border-gray-300 p-2 rounded">
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Rol</label>
          <select [(ngModel)]="newUser.role" name="role" required class="w-full border border-gray-300 p-2 rounded">
            <option value="" disabled selected>Seleccione un rol</option>
            <option value="Administrador">Administrador</option>
            <option value="Usuario">Usuario</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-gray-700">Contraseña</label>
          <input type="password" [(ngModel)]="newUser.password" name="password" required class="w-full border border-gray-300 p-2 rounded">
        </div>
        <div class="mb-4">
          <label class="inline-flex items-center">
            <input type="checkbox" [(ngModel)]="newUser.canExportExcel" name="canExportExcel" class="form-checkbox">
            <span class="ml-2">Permitir exportar Excel</span>
          </label>
        </div>
        <div class="mb-4">
          <label class="inline-flex items-center">
            <input type="checkbox" [(ngModel)]="newUser.canExportPdf" name="canExportPdf" class="form-checkbox">
            <span class="ml-2">Permitir exportar PDF</span>
          </label>
        </div>
        <div class="mb-4">
          <label class="inline-flex items-center">
            <input type="checkbox" [(ngModel)]="newUser.canCreateUser" name="canCreateUser" class="form-checkbox">
            <span class="ml-2">Permitir crear/modificar usuarios</span>
          </label>
        </div>
        <div class="flex justify-end">
          <button type="button" (click)="closeCreateModal()"
                  class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded mr-2">
            Cancelar
          </button>
          <button type="submit"
                  class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded">
            Crear
          </button>
        </div>
      </form>
    </div>
  </div>  

<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
  <div class="bg-white dark:bg-gray-900 p-5 flex justify-between">
    <div>
      <input
        type="text"
        [(ngModel)]="searchText"
        (input)="onSearchInputChange()"
        class="w-full border-2 border-gray-300 p-2 rounded-lg"
        placeholder="Buscar..."
      />
    </div>
    <div class="p-4">
        <button (click)="openCreateModal()"
                class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded">
          Crear Usuario
        </button>
      </div>
  </div>

  <div *ngIf="data && data.length > 0; else noRecords">
    <table class="table-fixed w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr>
          <th scope="col" class="px-6 py-3 w-1/12">ID</th>
          <th scope="col" class="px-6 py-3 w-3/12">Nombre Completo</th>
          <th scope="col" class="px-6 py-3 w-3/12">Usuario</th>
          <th scope="col" class="px-6 py-3 w-3/12">Role</th>
          <th scope="col" class="px-6 py-3 w-2/12">Exporta Excel</th>
          <th scope="col" class="px-6 py-3 w-3/12">Exporta PDF</th>
          <th scope="col" class="px-6 py-3 w-3/12">Crea/modifica usuarios</th>
          <th scope="col" class="px-6 py-3 w-3/12">Estatus</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let info of data">
          <td class="px-3 py-1">{{ info.id || '-------' }}</td>
          <td class="px-3 py-1">
            {{ info.Name + ' ' + info.ApellidoP + ' ' + info.ApellidoM || '-------' }}
          </td>
          <td class="px-3 py-1">{{ info.username || '-------' }}</td>
          <td class="px-3 py-1">{{ info.role || '-------' }}</td>
          
          <td class="px-3 py-1">
            <input
              type="checkbox"
              [(ngModel)]="info.canExportExcel"
              (ngModelChange)="onPermissionChange(info, 'canExportExcel', $event)"
            />
          </td>
          
          <td class="px-3 py-1">
            <input
              type="checkbox"
              [(ngModel)]="info.canExportPdf"
              (ngModelChange)="onPermissionChange(info, 'canExportPdf', $event)"
            />
          </td>
          
          <td class="px-3 py-1">
            <input
              type="checkbox"
              [(ngModel)]="info.canCreateUser"
              (ngModelChange)="onPermissionChange(info, 'canCreateUser', $event)"
            />
          </td>
          
          <td class="px-3 py-1">
            <select [(ngModel)]="info.newStatus" (change)="updateStatus(info)">
              <option *ngFor="let option of statusOptions" [ngValue]="option">
                {{ option }}
              </option>
            </select>
          </td>
          
          
        </tr>
      </tbody>
    </table>
  </div>
  <ng-template #noRecords>
    <div class="text-center py-4 text-gray-500">
      Sin registros
    </div>
  </ng-template>
</div>

<div class="flex justify-between p-5">
  <button
    class="cursor-pointer bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l"
    (click)="previousPage()"
    [disabled]="currentPage <= 1"
  >
    Anterior
  </button>
  <span>Página {{ currentPage }} de {{ totalPages }}</span>
  <button
    class="cursor-pointer bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r"
    (click)="nextPage()"
    [disabled]="currentPage >= totalPages"
  >
    Siguiente
  </button>
</div>
