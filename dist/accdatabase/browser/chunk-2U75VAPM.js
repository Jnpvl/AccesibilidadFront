import{a as G}from"./chunk-WMM35GRI.js";import{d as L,i as B}from"./chunk-FPZDSFJQ.js";import{a as A,b as N,c as H,f as U,l as R}from"./chunk-D4WMZNJR.js";import"./chunk-RV4HWPOC.js";import{l as D,m as W,n as O,o as z}from"./chunk-V5LGPLRQ.js";import{a as j}from"./chunk-O5QE2TLP.js";import{$ as u,$a as C,Fa as V,La as x,Sa as c,Ua as M,Ya as t,Za as i,_ as g,_a as b,aa as S,ba as E,c as w,cb as p,db as m,ib as r,jb as f,kb as k,lb as F,mb as h,nb as _,ob as y,rb as T,sb as I,va as a,wa as P}from"./chunk-DBOOX4Q2.js";function J(s,l){s&1&&(b(0,"div",18),t(1,"div",19)(2,"div",20)(3,"h2",21),r(4,"Descarga en curso"),i(),t(5,"p"),r(6,"Por favor, espere mientras se genera el reporte..."),i(),t(7,"div",22),S(),t(8,"svg",23),b(9,"circle",24)(10,"path",25),i()()()())}function Q(s,l){if(s&1){let e=C();t(0,"button",26),p("click",function(){g(e);let o=m();return u(o.excelOptions=!0)}),S(),t(1,"svg",27),b(2,"path",28),i(),E(),t(3,"span"),r(4,"Descargar Excel"),i()()}}function X(s,l){if(s&1){let e=C();t(0,"tr",34),p("click",function(){let o=g(e).$implicit,d=m(2);return u(d.detalles(o.PermisionarioId))}),t(1,"td",35),r(2),i(),t(3,"td",35),r(4),i(),t(5,"td",35),r(6),i(),t(7,"td",35),r(8),i(),t(9,"td",35),r(10),i(),t(11,"td",35),r(12),i(),t(13,"td",35),r(14),T(15,"date"),i(),t(16,"td",35),r(17),T(18,"date"),i()()}if(s&2){let e=l.$implicit;a(2),f(e.PermisionarioId||"-------"),a(2),f(e.TipoDePermiso||"-------"),a(2),f(e.Modalidad||"-------"),a(2),f(e.Municipio||"-------"),a(2),f(e.Sistema||"-------"),a(2),f(e.Permisionario||"-------"),a(2),f(I(15,8,e.FechaInicio||"-------","dd/MM/yyyy")),a(3),f(I(18,11,e.FechaTermino||"-------","dd/MM/yyyy"))}}function K(s,l){if(s&1&&(t(0,"table",12)(1,"thead",29)(2,"tr")(3,"th",30),r(4,"ID"),i(),t(5,"th",31),r(6,"Tipo de Permiso"),i(),t(7,"th",31),r(8,"Modalidad"),i(),t(9,"th",31),r(10,"Municipio"),i(),t(11,"th",32),r(12,"Sistema"),i(),t(13,"th",31),r(14,"Permisionario"),i(),t(15,"th",31),r(16,"Fecha Inicio"),i(),t(17,"th",31),r(18,"Fecha Termino"),i()()(),t(19,"tbody"),x(20,X,19,14,"tr",33),i()()),s&2){let e=m();a(20),c("ngForOf",e.data)}}function Y(s,l){s&1&&(t(0,"div",13),r(1," Sin registros "),i())}function Z(s,l){if(s&1&&x(0,Y,2,0,"div",36),s&2){let e=m();c("ngIf",e.data.length===0)}}function $(s,l){if(s&1){let e=C();t(0,"div",64)(1,"label",65),r(2),i(),t(3,"input",66),y("ngModelChange",function(o){g(e);let d=m().$implicit,v=m(2);return _(v.columnFilters[d.key],o)||(v.columnFilters[d.key]=o),u(o)}),i()()}if(s&2){let e=m().$implicit,n=m(2);a(),c("for",e.id+"_input"),a(),k(" Valor para ",e.label," "),a(),c("id",e.id+"_input"),h("ngModel",n.columnFilters[e.key])}}function ee(s,l){if(s&1){let e=C();t(0,"div")(1,"div",60)(2,"input",61),y("ngModelChange",function(o){let d=g(e).$implicit,v=m(2);return _(v.exportColumns[d.key],o)||(v.exportColumns[d.key]=o),u(o)}),i(),t(3,"label",62),r(4),i()(),x(5,$,4,4,"div",63),i()}if(s&2){let e=l.$implicit,n=m(2);a(2),c("id",e.id),h("ngModel",n.exportColumns[e.key]),c("disabled",n.exportAll),a(),c("for",e.id),a(),k(" ",e.label," "),a(),c("ngIf",n.exportColumns[e.key])}}function te(s,l){if(s&1){let e=C();t(0,"div",48)(1,"label",67),r(2," Buscar datos globalmente "),i(),t(3,"input",68),y("ngModelChange",function(o){g(e);let d=m(2);return _(d.globalSearch,o)||(d.globalSearch=o),u(o)}),i()()}if(s&2){let e=m(2);a(3),h("ngModel",e.globalSearch)}}function ie(s,l){if(s&1){let e=C();t(0,"div",17),b(1,"div",37),t(2,"div",38)(3,"div",39)(4,"div",40)(5,"div",41)(6,"div",42)(7,"div",43),S(),t(8,"svg",44),b(9,"path",45),i()(),E(),t(10,"div",46)(11,"h3",47),r(12," \xBFQu\xE9 datos buscas exportar? "),i()()(),t(13,"div",48)(14,"div",49)(15,"div",50)(16,"input",51),y("ngModelChange",function(o){g(e);let d=m();return _(d.exportAll,o)||(d.exportAll=o),u(o)}),p("change",function(){g(e);let o=m();return u(o.onExportAllChange())}),i(),t(17,"label",52),r(18," Todo el contenido sin filtros "),i()(),t(19,"div",50)(20,"input",53),y("ngModelChange",function(o){g(e);let d=m();return _(d.soloVigentes,o)||(d.soloVigentes=o),u(o)}),i(),t(21,"label",54),r(22,"Solo vigentes"),i()()(),t(23,"h1"),r(24,"Filtra por:"),i(),x(25,ee,6,6,"div",55)(26,te,4,1,"div",56),i()(),t(27,"div",57)(28,"button",58),p("click",function(){g(e);let o=m();return u(o.downloadExcel())}),r(29," Exportar "),i(),t(30,"button",59),p("click",function(){g(e);let o=m();return u(o.excelOptions=!1)}),r(31," Cancelar "),i()()()()()()}if(s&2){let e=m();a(16),h("ngModel",e.exportAll),a(4),h("ngModel",e.soloVigentes),a(5),c("ngForOf",e.filterOptions),a(),c("ngIf",!e.hasColumnFilters())}}var q=class s{constructor(l,e,n){this.permisosService=l;this.router=e;this.localStorageService=n;this.initializeData()}data=[];currentPage=1;totalPages=0;totalItems=0;pageSize=10;searchText="";isLoading=!1;excelOptions=!1;searchTimeout;fechaInicio="";fechaTermino="";exportAll=!1;exportColumns={TipoDePermiso:!1,NoExpediente:!1,Modalidad:!1,Sistema:!1,Permisionario:!1,Municipio:!1,Terminos:!1,Marca:!1,Modelo:!1,TipoDeUnidad:!1};columnFilters={TipoDePermiso:"",NoExpediente:"",Modalidad:"",Sistema:"",Permisionario:"",Municipio:"",Terminos:"",Marca:"",Modelo:"",TipoDeUnidad:""};soloVigentes=!1;globalSearch="";filterOptions=[{id:"tipoPermiso",key:"TipoDePermiso",label:"Tipo de Permiso"},{id:"noExpediente",key:"NoExpediente",label:"No. Expediente"},{id:"modalidad",key:"Modalidad",label:"Modalidad"},{id:"sistema",key:"Sistema",label:"Sistema"},{id:"permisionario",key:"Permisionario",label:"Permisionario"},{id:"municipio",key:"Municipio",label:"Municipio"},{id:"terminos",key:"Terminos",label:"T\xE9rminos"},{id:"marca",key:"Marca",label:"Marca"},{id:"modelo",key:"Modelo",label:"Modelo"},{id:"tipoUnidad",key:"TipoDeUnidad",label:"Tipo de Unidad"}];canExportExcel=!1;ngOnInit(){let l=this.localStorageService.getUser();l&&l.canExportExcel&&(this.canExportExcel=!0)}initializeData(){return w(this,null,function*(){let l=this.fechaInicio?`${this.fechaInicio} 00:00:00`:"",e=this.fechaTermino?`${this.fechaTermino} 23:59:59`:"",n=yield this.permisosService.getPermisos(this.currentPage,this.pageSize,this.searchText,l,e);this.currentPage=n.pagination.page,this.pageSize=n.pagination.pageSize,this.data=n.data,this.totalItems=n.pagination.totalRecords,this.totalPages=Math.ceil(this.totalItems/this.pageSize)})}onSearchInputChange(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.currentPage=1,this.initializeData()},500)}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadPage())}previousPage(){this.currentPage>1&&(this.currentPage--,this.loadPage())}loadPage(){return w(this,null,function*(){yield this.initializeData()})}onExportAllChange(){if(this.exportAll){for(let l in this.exportColumns)this.exportColumns[l]=!1;this.columnFilters={}}}hasColumnFilters(){return Object.values(this.exportColumns).some(l=>l===!0)}downloadExcel(){return w(this,null,function*(){if(!this.exportAll&&!this.soloVigentes&&!this.hasColumnFilters()&&(!this.globalSearch||this.globalSearch.trim()==="")){alert("Por favor, seleccione al menos una opci\xF3n antes de exportar.");return}this.isLoading=!0;let l={};if(this.hasColumnFilters())for(let e of this.filterOptions)this.exportColumns[e.key]&&this.columnFilters[e.key]&&this.columnFilters[e.key].trim()!==""&&(l[e.key]=this.columnFilters[e.key].trim());else this.globalSearch&&this.globalSearch.trim()!==""&&(l.global=this.globalSearch.trim());this.soloVigentes&&(l.soloVigentes="true");try{yield this.permisosService.downloadExcel({filters:JSON.stringify(l)}),this.excelOptions=!1,this.isLoading=!1,this.globalSearch="";for(let e in this.columnFilters)this.columnFilters[e]="";for(let e in this.exportColumns)this.exportColumns[e]=!1;this.soloVigentes=!1}catch(e){console.error("Error al descargar el Excel",e),this.isLoading=!1}})}detalles(l){this.router.navigate(["/dashboard/permisos-detail",l])}onDateChange(){this.initializeData()}resetDateFilter(){this.fechaInicio="",this.fechaTermino="",this.initializeData()}static \u0275fac=function(e){return new(e||s)(P(G),P(L),P(B))};static \u0275cmp=V({type:s,selectors:[["app-permisos"]],decls:29,vars:11,consts:[["title","Permisos"],[1,"relative","overflow-x-auto","shadow-md","sm:rounded-lg"],[1,"bg-white","dark:bg-gray-900","p-5","flex","justify-between"],["type","text","placeholder","Buscar...",1,"w-100","border-2","border-gray-300","p-2","rounded-lg",3,"ngModelChange","input","ngModel"],[1,"flex","items-center","gap-4"],[1,"flex","flex-col","items-start"],["for","start",1,"font-medium","mb-1"],["type","date","id","start",1,"border","border-gray-300","rounded-md","p-2","focus:outline-none","focus:ring-2","focus:ring-red-400",3,"ngModelChange","change","ngModel"],["for","final",1,"font-medium","mb-1"],["type","date","id","final",1,"border","border-gray-300","rounded-md","p-2","focus:outline-none","focus:ring-2","focus:ring-red-400",3,"ngModelChange","change","ngModel"],[1,"cursor-pointer","bg-red-500","hover:bg-red-600","h-10","text-white","font-bold","py-2","px-4","rounded-md","flex","items-center","justify-center","mt-6",3,"click"],["class","cursor-pointer bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded inline-flex items-center",3,"click",4,"ngIf"],[1,"table-fixed","w-full","text-sm","text-left","rtl:text-right","text-gray-500","dark:text-gray-400"],[1,"text-center","py-4","text-gray-500"],[1,"flex","justify-between","p-5"],[1,"cursor-pointer","bg-gray-300","hover:bg-gray-400","text-gray-800","font-bold","py-2","px-4","rounded-l",3,"click","disabled"],[1,"cursor-pointer","bg-gray-300","hover:bg-gray-400","text-gray-800","font-bold","py-2","px-4","rounded-r",3,"click","disabled"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"relative","z-10"],[1,"fixed","inset-0","bg-black","opacity-50","z-40"],[1,"fixed","inset-0","flex","items-center","justify-center","z-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","flex","flex-col","items-center"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center","justify-center","mt-4"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-10","w-10","text-[#B94645]"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"cursor-pointer","bg-gray-300","hover:bg-gray-400","text-gray-800","font-bold","py-2","px-4","rounded","inline-flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20",1,"fill-current","w-4","h-4","mr-2"],["d","M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50","dark:bg-gray-700","dark:text-gray-400"],["scope","col",1,"px-6","py-3","w-1/12"],["scope","col",1,"px-6","py-3","w-3/12"],["scope","col",1,"px-6","py-3","w-2/12"],["class","hover:bg-[#DC7F37] cursor-pointer",3,"click",4,"ngFor","ngForOf"],[1,"hover:bg-[#DC7F37]","cursor-pointer",3,"click"],[1,"px-3","py-1"],["class","text-center py-4 text-gray-500",4,"ngIf"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500/75","transition-opacity"],[1,"fixed","inset-0","z-10","w-screen","overflow-y-auto"],[1,"flex","min-h-full","items-end","justify-center","p-4","text-center","sm:items-center","sm:p-0"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg"],[1,"bg-white","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"flex","items-center","p-2"],[1,"flex","h-12","w-12","items-center","justify-center","rounded-full","bg-green-100","sm:h-10","sm:w-10"],["fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor","aria-hidden","true",1,"h-6","w-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","d","M7 7h10M7 11h10m-3 4h3M12 3v4m0 0H8a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-6"],[1,"ml-2"],["id","modal-title",1,"text-base","font-semibold","text-gray-900"],[1,"mt-4"],[1,"flex","flex-row","items-center","bg-gray-100","w-full","space-x-4","m-5"],[1,"flex","items-center"],["id","todo","type","checkbox","name","exportOptions",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","cursor-pointer",3,"ngModelChange","change","ngModel"],["for","todo",1,"ml-2","text-sm","font-medium","text-gray-900"],["id","soloVigentes","type","checkbox",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","cursor-pointer",3,"ngModelChange","ngModel"],["for","soloVigentes",1,"ml-2","text-sm","font-medium","text-gray-900"],[4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],[1,"bg-gray-50","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"cursor-pointer","inline-flex","w-full","justify-center","rounded-md","bg-red-600","px-3","py-2","text-sm","font-semibold","text-white","shadow-xs","hover:bg-red-500","sm:ml-3","sm:w-auto",3,"click"],["type","button",1,"cursor-pointer","mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","px-3","py-2","text-sm","font-semibold","text-gray-900","ring-1","shadow-xs","ring-gray-300","ring-inset","hover:bg-gray-50","sm:mt-0","sm:w-auto",3,"click"],[1,"flex","items-center","mb-2"],["type","checkbox","name","exportOptions",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","cursor-pointer",3,"ngModelChange","id","ngModel","disabled"],[1,"ml-2","text-sm","font-medium","text-gray-900",3,"for"],["class","mb-2 ml-6",4,"ngIf"],[1,"mb-2","ml-6"],[1,"block","text-xs","text-gray-700",3,"for"],["type","text","placeholder","Ingrese valor",1,"mt-1","block","w-full","border-gray-300","rounded-md","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","id","ngModel"],["for","globalSearch",1,"block","text-sm","font-medium","text-gray-900"],["id","globalSearch","type","text","placeholder","Ingrese t\xE9rmino de b\xFAsqueda",1,"mt-1","block","w-full","border-gray-300","rounded-md","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"]],template:function(e,n){e&1&&(x(0,J,11,0),b(1,"app-title",0),t(2,"div",1)(3,"div",2)(4,"div")(5,"input",3),y("ngModelChange",function(d){return _(n.searchText,d)||(n.searchText=d),d}),p("input",function(){return n.onSearchInputChange()}),i()(),t(6,"div",4)(7,"div",5)(8,"label",6),r(9,"Inicio:"),i(),t(10,"input",7),y("ngModelChange",function(d){return _(n.fechaInicio,d)||(n.fechaInicio=d),d}),p("change",function(){return n.onDateChange()}),i()(),t(11,"div",5)(12,"label",8),r(13,"Final:"),i(),t(14,"input",9),y("ngModelChange",function(d){return _(n.fechaTermino,d)||(n.fechaTermino=d),d}),p("change",function(){return n.onDateChange()}),i()(),t(15,"button",10),p("click",function(){return n.resetDateFilter()}),r(16," X "),i()(),x(17,Q,5,0,"button",11),i(),t(18,"div"),x(19,K,21,1,"table",12)(20,Z,1,1,"div",13),i()(),t(21,"div",14)(22,"button",15),p("click",function(){return n.previousPage()}),r(23," Anterior "),i(),t(24,"span"),r(25),i(),t(26,"button",16),p("click",function(){return n.nextPage()}),r(27," Siguiente "),i()(),x(28,ie,32,4,"div",17)),e&2&&(M(n.isLoading?0:-1),a(5),h("ngModel",n.searchText),a(5),h("ngModel",n.fechaInicio),a(4),h("ngModel",n.fechaTermino),a(3),c("ngIf",n.canExportExcel),a(2),M(n.data.length>0?19:20),a(3),c("disabled",n.currentPage<=1),a(3),F("P\xE1gina ",n.currentPage," de ",n.totalPages,""),a(),c("disabled",n.currentPage>=n.totalPages),a(2),M(n.excelOptions?28:-1))},dependencies:[j,z,D,W,O,R,N,A,H,U],encapsulation:2})};export{q as PermisosComponent};
