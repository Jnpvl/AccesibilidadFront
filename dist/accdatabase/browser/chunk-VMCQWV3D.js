import{a as z,b as B,c as U,f as A,l as R}from"./chunk-D4WMZNJR.js";import{a as N}from"./chunk-RV4HWPOC.js";import{l as O,m as j,o as D}from"./chunk-V5LGPLRQ.js";import{a as W}from"./chunk-O5QE2TLP.js";import{$ as x,$a as w,Fa as L,La as h,O as P,Sa as m,T as V,Ua as k,Ya as n,Za as o,_ as u,_a as y,aa as v,ba as S,c as g,cb as f,db as d,ib as l,jb as E,kb as T,lb as F,mb as b,nb as _,ob as C,va as s,wa as I}from"./chunk-DBOOX4Q2.js";var M=class a{constructor(t){this.apiclientService=t}getConcesionario(t,e,i){return g(this,null,function*(){let r=new URLSearchParams({page:t.toString(),pageSize:e.toString()});return i&&r.append("search",i),this.apiclientService.get(`concesionarios?${r.toString()}`)})}downloadReport(){return g(this,null,function*(){try{let t=yield this.apiclientService.get("concesionarios/report",{responseType:"blob"}),e=window.URL.createObjectURL(t),i=document.createElement("a");i.href=e,i.download="reporte_concesiones.pdf",document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(e)}catch(t){console.error("Error al descargar el reporte:",t)}})}downloadExcel(t){return g(this,null,function*(){try{let e=new URLSearchParams;t.columns&&e.append("columns",t.columns),t.filters&&e.append("filters",t.filters);let i=`concesionarios/excel?${e.toString()}`,r=yield this.apiclientService.get(i,{responseType:"blob"}),c=window.URL.createObjectURL(r),p=document.createElement("a");p.href=c,p.download="reporte_concesiones.xlsx",document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(c)}catch(e){console.error("Error al descargar el excel",e)}})}static \u0275fac=function(e){return new(e||a)(V(N))};static \u0275prov=P({token:a,factory:a.\u0275fac,providedIn:"root"})};function J(a,t){a&1&&(y(0,"div",14),n(1,"div",15)(2,"div",16)(3,"h2",17),l(4,"Descarga en curso"),o(),n(5,"p"),l(6,"Por favor, espere mientras se genera el reporte..."),o(),n(7,"div",18),v(),n(8,"svg",19),y(9,"circle",20)(10,"path",21),o()()()())}function Q(a,t){if(a&1&&(n(0,"tr")(1,"td",26),l(2),o(),n(3,"td",26),l(4),o(),n(5,"td",26),l(6),o()()),a&2){let e=t.$implicit;s(2),E(e.kCodigo||"-------"),s(2),E(e.kTerminos||"-------"),s(2),E(e.kConcesionario||"-------")}}function K(a,t){if(a&1&&(n(0,"table",8)(1,"thead",22)(2,"tr")(3,"th",23),l(4,"ID"),o(),n(5,"th",24),l(6,"Terminos"),o(),n(7,"th",24),l(8,"Concesionario"),o()()(),n(9,"tbody"),h(10,Q,7,3,"tr",25),o()()),a&2){let e=d();s(10),m("ngForOf",e.data)}}function X(a,t){a&1&&(n(0,"div",9),l(1," Sin registros "),o())}function Y(a,t){if(a&1&&h(0,X,2,0,"div",27),a&2){let e=d();m("ngIf",e.data.length===0)}}function Z(a,t){if(a&1){let e=w();n(0,"div",54)(1,"label",55),l(2),o(),n(3,"input",56),C("ngModelChange",function(r){u(e);let c=d().$implicit,p=d(2);return _(p.columnFilters[c.key],r)||(p.columnFilters[c.key]=r),x(r)}),o()()}if(a&2){let e=d().$implicit,i=d(2);s(),m("for",e.id+"_input"),s(),T(" Valor para ",e.label," "),s(),m("id",e.id+"_input"),b("ngModel",i.columnFilters[e.key])}}function $(a,t){if(a&1){let e=w();n(0,"div")(1,"div",50)(2,"input",51),C("ngModelChange",function(r){let c=u(e).$implicit,p=d(2);return _(p.exportColumns[c.key],r)||(p.exportColumns[c.key]=r),x(r)}),o(),n(3,"label",52),l(4),o()(),h(5,Z,4,4,"div",53),o()}if(a&2){let e=t.$implicit,i=d(2);s(2),m("id",e.id),b("ngModel",i.exportColumns[e.key]),m("disabled",i.exportAll),s(),m("for",e.id),s(),T(" ",e.label," "),s(),m("ngIf",i.exportColumns[e.key])}}function ee(a,t){if(a&1){let e=w();n(0,"div",39)(1,"label",57),l(2," Buscar datos globalmente "),o(),n(3,"input",58),C("ngModelChange",function(r){u(e);let c=d(2);return _(c.globalSearch,r)||(c.globalSearch=r),x(r)}),o()()}if(a&2){let e=d(2);s(3),b("ngModel",e.globalSearch)}}function te(a,t){if(a&1){let e=w();n(0,"div",13),y(1,"div",28),n(2,"div",29)(3,"div",30)(4,"div",31)(5,"div",32)(6,"div",33)(7,"div",34),v(),n(8,"svg",35),y(9,"path",36),o()(),S(),n(10,"div",37)(11,"h3",38),l(12," \xBFQu\xE9 datos buscas exportar? "),o()()(),n(13,"div",39)(14,"div",40)(15,"div",41)(16,"input",42),C("ngModelChange",function(r){u(e);let c=d();return _(c.exportAll,r)||(c.exportAll=r),x(r)}),f("change",function(){u(e);let r=d();return x(r.onExportAllChange())}),o(),n(17,"label",43),l(18," Todo el contenido sin filtros "),o()(),n(19,"div",41)(20,"input",44),C("ngModelChange",function(r){u(e);let c=d();return _(c.soloVigentes,r)||(c.soloVigentes=r),x(r)}),o(),n(21,"label",45),l(22,"Solo vigentes"),o()()(),n(23,"h1"),l(24,"Filtra por:"),o(),h(25,$,6,6,"div",25)(26,ee,4,1,"div",46),o()(),n(27,"div",47)(28,"button",48),f("click",function(){u(e);let r=d();return x(r.downloadExcel())}),l(29," Exportar "),o(),n(30,"button",49),f("click",function(){u(e);let r=d();return x(r.excelOptions=!1)}),l(31," Cancelar "),o()()()()()()}if(a&2){let e=d();s(16),b("ngModel",e.exportAll),s(4),b("ngModel",e.soloVigentes),s(5),m("ngForOf",e.filterOptions),s(),m("ngIf",!e.hasColumnFilters())}}var H=class a{constructor(t){this.concesionarioService=t;this.initializeData()}data=[];currentPage=1;totalPages=0;totalItems=0;pageSize=0;searchText="";isLoading=!1;excelOptions=!1;searchTimeout;exportAll=!1;exportColumns={TipoDePermiso:!1,NoExpediente:!1,Modalidad:!1,Sistema:!1,Permisionario:!1,Municipio:!1,Terminos:!1,Marca:!1,Modelo:!1,TipoDeUnidad:!1};columnFilters={TipoDePermiso:"",NoExpediente:"",Modalidad:"",Sistema:"",Permisionario:"",Municipio:"",Terminos:"",Marca:"",Modelo:"",TipoDeUnidad:""};soloVigentes=!1;globalSearch="";filterOptions=[{id:"tipoPermiso",key:"TipoDePermiso",label:"Tipo de Permiso"},{id:"noExpediente",key:"NoExpediente",label:"No. Expediente"},{id:"modalidad",key:"Modalidad",label:"Modalidad"},{id:"sistema",key:"Sistema",label:"Sistema"},{id:"permisionario",key:"Permisionario",label:"Permisionario"},{id:"municipio",key:"Municipio",label:"Municipio"},{id:"terminos",key:"Terminos",label:"T\xE9rminos"},{id:"marca",key:"Marca",label:"Marca"},{id:"modelo",key:"Modelo",label:"Modelo"},{id:"tipoUnidad",key:"TipoDeUnidad",label:"Tipo de Unidad"}];initializeData(){return g(this,null,function*(){let t=yield this.concesionarioService.getConcesionario(this.currentPage,this.pageSize,this.searchText);this.currentPage=t.pagination.page,this.pageSize=t.pagination.pageSize,this.data=t.data,this.totalItems=t.pagination.totalRecords,this.totalPages=Math.ceil(this.totalItems/this.pageSize)})}onSearchInputChange(){clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout(()=>{this.currentPage=1,this.initializeData()},500)}nextPage(){this.currentPage<this.totalPages&&(this.currentPage++,this.loadPage())}previousPage(){this.currentPage>1&&(this.currentPage--,this.loadPage())}loadPage(){return g(this,null,function*(){yield this.initializeData()})}downloadPdf(){return g(this,null,function*(){this.isLoading=!0;try{yield this.concesionarioService.downloadReport()}catch(t){console.error("Error al descargar el reporte:",t),alert("Error al descargar el reporte. Por favor, int\xE9ntalo de nuevo.")}finally{this.isLoading=!1}})}onExportAllChange(){if(this.exportAll){for(let t in this.exportColumns)this.exportColumns[t]=!1;this.columnFilters={}}}hasColumnFilters(){return Object.values(this.exportColumns).some(t=>t===!0)}downloadExcel(){return g(this,null,function*(){this.isLoading=!0;let t={};if(this.hasColumnFilters())for(let e of this.filterOptions)this.exportColumns[e.key]&&this.columnFilters[e.key]&&this.columnFilters[e.key].trim()!==""&&(t[e.key]=this.columnFilters[e.key].trim());else this.globalSearch&&this.globalSearch.trim()!==""&&(t.global=this.globalSearch.trim());this.soloVigentes&&(t.soloVigentes="true");try{yield this.concesionarioService.downloadExcel({filters:JSON.stringify(t)}),this.excelOptions=!1,this.isLoading=!1,this.globalSearch="";for(let e in this.columnFilters)this.columnFilters[e]="";for(let e in this.exportColumns)this.exportColumns[e]=!1;this.soloVigentes=!1}catch(e){console.error("Error al descargar el Excel",e),this.isLoading=!1}})}static \u0275fac=function(e){return new(e||a)(I(M))};static \u0275cmp=L({type:a,selectors:[["app-concesionario"]],decls:28,vars:8,consts:[["title","Concesionario"],[1,"relative","overflow-x-auto","shadow-md","sm:rounded-lg"],[1,"bg-white","dark:bg-gray-900","p-5","flex","justify-between"],["type","text","placeholder","Buscar...",1,"w-100","border-2","border-gray-300","p-2","rounded-lg",3,"ngModelChange","input","ngModel"],[1,"w-100","flex","justify-between"],[1,"cursor-pointer","bg-gray-300","hover:bg-gray-400","text-gray-800","font-bold","py-2","px-4","rounded","inline-flex","items-center",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 20 20",1,"fill-current","w-4","h-4","mr-2"],["d","M13 8V2H7v6H2l8 8 8-8h-5zM0 18h20v2H0v-2z"],[1,"table-fixed","w-full","text-sm","text-left","rtl:text-right","text-gray-500","dark:text-gray-400"],[1,"text-center","py-4","text-gray-500"],[1,"flex","justify-between","p-5"],[1,"bg-gray-300","hover:bg-gray-400","text-gray-800","font-bold","py-2","px-4","rounded-l",3,"click","disabled"],[1,"bg-gray-300","hover:bg-gray-400","text-gray-800","font-bold","py-2","px-4","rounded-r",3,"click","disabled"],["aria-labelledby","modal-title","role","dialog","aria-modal","true",1,"relative","z-10"],[1,"fixed","inset-0","bg-black","opacity-50","z-40"],[1,"fixed","inset-0","flex","items-center","justify-center","z-50"],[1,"bg-white","p-6","rounded-lg","shadow-lg","flex","flex-col","items-center"],[1,"text-xl","font-bold","mb-4"],[1,"flex","items-center","justify-center","mt-4"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24",1,"animate-spin","h-10","w-10","text-[#B94645]"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"],[1,"text-xs","text-gray-700","uppercase","bg-gray-50","dark:bg-gray-700","dark:text-gray-400"],["scope","col",1,"px-6","py-3","w-1/12"],["scope","col",1,"px-6","py-3","w-3/12"],[4,"ngFor","ngForOf"],[1,"px-3","py-1"],["class","text-center py-4 text-gray-500",4,"ngIf"],["aria-hidden","true",1,"fixed","inset-0","bg-gray-500/75","transition-opacity"],[1,"fixed","inset-0","z-10","w-screen","overflow-y-auto"],[1,"flex","min-h-full","items-end","justify-center","p-4","text-center","sm:items-center","sm:p-0"],[1,"relative","transform","overflow-hidden","rounded-lg","bg-white","text-left","shadow-xl","transition-all","sm:my-8","sm:w-full","sm:max-w-lg"],[1,"bg-white","px-4","pt-5","pb-4","sm:p-6","sm:pb-4"],[1,"flex","items-center","p-2"],[1,"flex","h-12","w-12","items-center","justify-center","rounded-full","bg-green-100","sm:h-10","sm:w-10"],["fill","none","viewBox","0 0 24 24","stroke-width","1.5","stroke","currentColor","aria-hidden","true",1,"h-6","w-6","text-green-600"],["stroke-linecap","round","stroke-linejoin","round","d","M7 7h10M7 11h10m-3 4h3M12 3v4m0 0H8a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2v-6"],[1,"ml-2"],["id","modal-title",1,"text-base","font-semibold","text-gray-900"],[1,"mt-4"],[1,"flex","flex-row","items-center","bg-gray-100","w-full","space-x-4","m-5"],[1,"flex","items-center"],["id","todo","type","checkbox","name","exportOptions",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","cursor-pointer",3,"ngModelChange","change","ngModel"],["for","todo",1,"ml-2","text-sm","font-medium","text-gray-900"],["id","soloVigentes","type","checkbox",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","cursor-pointer",3,"ngModelChange","ngModel"],["for","soloVigentes",1,"ml-2","text-sm","font-medium","text-gray-900"],["class","mt-4",4,"ngIf"],[1,"bg-gray-50","px-4","py-3","sm:flex","sm:flex-row-reverse","sm:px-6"],["type","button",1,"cursor-pointer","inline-flex","w-full","justify-center","rounded-md","bg-red-600","px-3","py-2","text-sm","font-semibold","text-white","shadow-xs","hover:bg-red-500","sm:ml-3","sm:w-auto",3,"click"],["type","button",1,"cursor-pointer","mt-3","inline-flex","w-full","justify-center","rounded-md","bg-white","px-3","py-2","text-sm","font-semibold","text-gray-900","ring-1","shadow-xs","ring-gray-300","ring-inset","hover:bg-gray-50","sm:mt-0","sm:w-auto",3,"click"],[1,"flex","items-center","mb-2"],["type","checkbox","name","exportOptions",1,"w-4","h-4","text-blue-600","bg-gray-100","border-gray-300","rounded","focus:ring-blue-500","cursor-pointer",3,"ngModelChange","id","ngModel","disabled"],[1,"ml-2","text-sm","font-medium","text-gray-900",3,"for"],["class","mb-2 ml-6",4,"ngIf"],[1,"mb-2","ml-6"],[1,"block","text-xs","text-gray-700",3,"for"],["type","text","placeholder","Ingrese valor",1,"mt-1","block","w-full","border-gray-300","rounded-md","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","id","ngModel"],["for","globalSearch",1,"block","text-sm","font-medium","text-gray-900"],["id","globalSearch","type","text","placeholder","Ingrese t\xE9rmino de b\xFAsqueda",1,"mt-1","block","w-full","border-gray-300","rounded-md","shadow-sm","focus:border-blue-500","focus:ring-blue-500",3,"ngModelChange","ngModel"]],template:function(e,i){e&1&&(h(0,J,11,0),y(1,"app-title",0),n(2,"div",1)(3,"div",2)(4,"div")(5,"input",3),C("ngModelChange",function(c){return _(i.searchText,c)||(i.searchText=c),c}),f("input",function(){return i.onSearchInputChange()}),o()(),n(6,"div",4)(7,"button",5),f("click",function(){return i.downloadPdf()}),v(),n(8,"svg",6),y(9,"path",7),o(),S(),n(10,"span"),l(11,"Descargar Pdf"),o()(),n(12,"button",5),f("click",function(){return i.excelOptions=!0}),v(),n(13,"svg",6),y(14,"path",7),o(),S(),n(15,"span"),l(16,"Descargar Excel"),o()()()(),n(17,"div"),h(18,K,11,1,"table",8)(19,Y,1,1,"div",9),o()(),n(20,"div",10)(21,"button",11),f("click",function(){return i.previousPage()}),l(22," Anterior "),o(),n(23,"span"),l(24),o(),n(25,"button",12),f("click",function(){return i.nextPage()}),l(26," Siguiente "),o()(),h(27,te,32,4,"div",13)),e&2&&(k(i.isLoading?0:-1),s(5),b("ngModel",i.searchText),s(13),k(i.data.length>0?18:19),s(3),m("disabled",i.currentPage<=1),s(3),F("P\xE1gina ",i.currentPage," de ",i.totalPages,""),s(),m("disabled",i.currentPage>=i.totalPages),s(2),k(i.excelOptions?27:-1))},dependencies:[W,D,O,j,R,B,z,U,A],encapsulation:2})};export{H as ConcesionarioComponent};
